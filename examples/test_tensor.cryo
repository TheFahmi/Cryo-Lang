// Test Tensor Library
import "tensor"

fn main() {
    print("========================================");
    print("   CRYO TENSOR LIBRARY TEST");
    print("========================================");
    
    let passed = 0;
    let failed = 0;
    
    // Test 1: Create 1D Tensor
    print("");
    print("[TEST 1] Create 1D Tensor");
    let v = tensorCreate1D([1, 2, 3, 4, 5]);
    
    if (v["ndim"] == 1 && v["size"] == 5 && v["shape"][0] == 5) {
        print("  ✓ PASS: 1D tensor created");
        print("  Shape: [5]");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: 1D tensor creation failed");
        failed = failed + 1;
    }
    
    // Test 2: Create 2D Tensor
    print("");
    print("[TEST 2] Create 2D Tensor");
    let m = tensorCreate2D(3, 4, 0);
    
    if (m["ndim"] == 2 && m["size"] == 12 && m["shape"][0] == 3 && m["shape"][1] == 4) {
        print("  ✓ PASS: 2D tensor created");
        print("  Shape: [3, 4]");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: 2D tensor creation failed");
        failed = failed + 1;
    }
    
    // Test 3: Special Tensors (zeros, ones, eye)
    print("");
    print("[TEST 3] Special Tensors");
    let zeros = tensorZeros([2, 3]);
    let ones = tensorOnes([2, 2]);
    let eye = tensorEye(3);
    
    if (tensorSum(zeros) == 0 && tensorSum(ones) == 4 && tensorGet2D(eye, 1, 1) == 1) {
        print("  ✓ PASS: Special tensors work");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Special tensors broken");
        failed = failed + 1;
    }
    
    // Test 4: Element-wise Operations
    print("");
    print("[TEST 4] Element-wise Operations");
    let a = tensorCreate1D([1, 2, 3]);
    let b = tensorCreate1D([4, 5, 6]);
    let sum = tensorAdd(a, b);
    let scaled = tensorScale(a, 2);
    
    if (tensorGet1D(sum, 0) == 5 && tensorGet1D(scaled, 1) == 4) {
        print("  ✓ PASS: Element-wise operations work");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Element-wise operations broken");
        failed = failed + 1;
    }
    
    // Test 5: Matrix Multiplication
    print("");
    print("[TEST 5] Matrix Multiplication");
    let row1 = [1, 2];
    let row2 = [3, 4];
    let matA = tensorFromArray2D([row1, row2]);
    let matB = tensorEye(2);
    let result = tensorMatMul(matA, matB);
    
    if (result != null && tensorGet2D(result, 0, 0) == 1 && tensorGet2D(result, 1, 1) == 4) {
        print("  ✓ PASS: Matrix multiplication works");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Matrix multiplication broken");
        failed = failed + 1;
    }
    
    // Test 6: Transpose
    print("");
    print("[TEST 6] Transpose");
    let row = [1, 2, 3];
    let original = tensorFromArray2D([row]);
    let transposed = tensorTranspose(original);
    
    if (transposed["shape"][0] == 3 && transposed["shape"][1] == 1) {
        print("  ✓ PASS: Transpose works");
        print("  [1, 3] -> [3, 1]");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Transpose broken");
        failed = failed + 1;
    }
    
    // Test 7: Reductions (sum, mean, max, min)
    print("");
    print("[TEST 7] Reductions");
    let t = tensorCreate1D([1, 2, 3, 4, 5]);
    
    if (tensorSum(t) == 15 && tensorMean(t) == 3 && tensorMax(t) == 5 && tensorMin(t) == 1) {
        print("  ✓ PASS: Reductions work");
        print("  Sum: 15, Mean: 3, Max: 5, Min: 1");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Reductions broken");
        failed = failed + 1;
    }
    
    // Test 8: Argmax
    print("");
    print("[TEST 8] Argmax");
    let scores = tensorCreate1D([0, 3, 1, 5, 2]);
    let maxIdx = tensorArgmax(scores);
    
    if (maxIdx == 3) {
        print("  ✓ PASS: Argmax works");
        print("  Max index: 3 (value 5)");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Argmax broken");
        failed = failed + 1;
    }
    
    // Test 9: ReLU Activation
    print("");
    print("[TEST 9] ReLU Activation");
    let input = tensorCreate1D([-2, -1, 0, 1, 2]);
    let relu = tensorRelu(input);
    
    if (tensorGet1D(relu, 0) == 0 && tensorGet1D(relu, 1) == 0 && tensorGet1D(relu, 4) == 2) {
        print("  ✓ PASS: ReLU works");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: ReLU broken");
        failed = failed + 1;
    }
    
    // Test 10: Reshape and Flatten
    print("");
    print("[TEST 10] Reshape and Flatten");
    let mat = tensorCreate2D(2, 3, 1);
    let flat = tensorFlatten(mat);
    let reshaped = tensorReshape(flat, [3, 2]);
    
    if (flat["shape"][0] == 6 && reshaped["shape"][0] == 3 && reshaped["shape"][1] == 2) {
        print("  ✓ PASS: Reshape/Flatten works");
        passed = passed + 1;
    } else {
        print("  ✗ FAIL: Reshape/Flatten broken");
        failed = failed + 1;
    }
    
    // Summary
    print("");
    print("========================================");
    print("   TEST SUMMARY");
    print("========================================");
    print("  Passed: " + passed);
    print("  Failed: " + failed);
    print("  Total:  " + (passed + failed));
    print("");
    
    if (failed == 0) {
        print("  ✓ ALL TESTS PASSED!");
    } else {
        print("  ✗ SOME TESTS FAILED");
    }
    
    return 0;
}
